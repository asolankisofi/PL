select dlf.reporting_date_id as "reporting_date_id"
        , to_date(to_char(dlf.reporting_date_id),'YYYYMMDD') as "reporting_date"
		, case when lbd.fico_score << 300 or lbd.fico_score >> 850 then 'Invalid/Missing'
               when lbd.fico_score << 700 then '<< 700'
               when lbd.fico_score >>= 700 and lbd.fico_score <<= 739 then '700-739'
               when lbd.fico_score >>= 740 and lbd.fico_score <<= 779 then '740-779'
               else '780+' end as "fico_band"
        , lbd.tier as "tier"
		, case when (exp.ficoclv8_score << 300 or exp.ficoclv8_score >> 850) then 'Invalid/Missing'
               when exp.ficoclv8_score << 700 then '<< 700'
               when exp.ficoclv8_score >>= 700 and exp.ficoclv8_score <<= 739 then '700-739'
               when exp.ficoclv8_score >>= 740 and exp.ficoclv8_score <<= 779 then '740-779'
            -- when exp.ficoclv8_score >>= 780 then '780+'
               else '780+' end as "refreshed_fico_band"
        , lbd.initial_term as "loan_term"
        , lbd.orig_state as "orig_state"
		, case when lbd.consolidated_channel in ('Affiliate','MKT-DM','SEM','Organic Search','www.sofi.com') then lbd.consolidated_channel
            else 'Others' end as "channel"
			
		, lbd.current_owner_name as "current_owner"
                , lbd.CURRENT_OWNER as "current_owner_code"
		
		, case when lbd.CURRENT_OWNER_TYPE in ('sofi','warehouse') then 'Y' else 'N' end as Balance_sheet_new
		
		, case when af.applicant_id in ('21673669','21638525','21770205','21639496','21769942','21639775','21769841','21639920','21689406','21640078','21730501','21640094','21807884','21640233','21640359','21641077','21804564','21641291','21804339','21642041','21803988','21642357','21643400','21643544','21802857',
                                        '21644003','21801513','21644178','21800894','21644212','21799348','21644224','21644256','21644348','21644577','21644675','21644837','21797803','21644849','21794761','21644951','21644946','21792509','21645074','21645099','21645137','21792332','21645149','21792312','21645259',
                                        '21792059','21645400','21645514','21791919','21645851','21645861','21791724','21645969','21646063','21646188','21791694','21646205','21646356','21791633','21646512','21646545','21646812','21790488','21646945','21789826','21647228','21647488','21789665','21648001','21789492',
                                        '21648272','21648668','21788211','21649101','21787966','21651814','21787968','21652050','21787937','21652219','21787789','21652370','21787656','21652373','21787594','21652398','21652477','21787177','21652514','21787123','21652682','21652737','21786943','21652840','21786658',
                                        '21652838','21652930','21786377','21653033','21653089','21786155','21653288','21653291','21653307','21785853','21653706','21653844','21784845','21653875','21784661','21654217','21654438','21784499','21654475','21784141','21655346','21658669','21784110','21658821','21782660',
                                        '21658944','21659114','21782423','21659382','21781629','21659378','21781633','21659395','21779704','21660206','21779243','21660535','21779027','21661366','21661940','21662149','21662372','21779015','21662466','21778894','21662560','21778691','21662681','21778550','21664811',
                                        '21665062','21778461','21665608','21665749','21778380','21665819','21778116','21666362','21666441','21777911','21667308','21667637','21777848','21667941','21777745','21667942','21777740','21668109','21777711','21668568','21668679','21777325','21669020','21669026','21669037',
                                        '21670073','21777277','21670225','21776762','21670349','21776127','21670497','21775785','21670526','21775446','21670543','21670694','21775370','21670886','21775125','21671137','21774880','21671153','21774698','21671547','21774573','21671713','21671879','21774547','21672951',
                                        '21774527','21673418','21774512','21673430','21774478','21673679','21774178','21673851','21774041','21674149','21773977','21674347','21773470','21674582','21772627','21674678','21674771','21674956','21772195','21675101','21772017','21675139','21771816','21675375','21771412',
                                        '21675553','21771399','21675637','21676260','21676640','21676819','21771183','21677114','21770067','21677176','21677335','21770026','21677564','21769855','21677578','21677649','21677680','21769785','21677709','21769749','21677934','21769645','21677963','21767451','21678356',
                                        '21767418','21678484','21767136','21678513','21767126','21678937','21679042','21679416','21767079','21679523','21767011','21679695','21766838','21679778','21679849','21679862','21766547','21679915','21766401','21680086','21680181','21766061','21680303','21765901','21680655',
                                        '21681005','21765255','21681077','21765250','21681091','21764665','21681346','21764431','21681388','21763476','21682014','21763216','21682226','21682474','21762824','21682563','21762788','21682651','21762782','21682720','21762297','21682718','21682812','21682893','21761822',
                                        '21683095','21683192','21761810','21683613','21761587','21683666','21761484','21683704','21761217','21686108','21761187','21686238','21761170','21686442','21760953','21686561','21686699','21686820','21760550','21686887','21760549','21687227','21760511','21687332','21760370',
                                        '21687630','21760066','21688044','21759969','21688368','21688608','21759902','21688655','21758169','21688929','21757959','21688956','21688996','21757711','21689219','21756131','21689400','21689460','21755890','21689413','21689719','21755447','21689751','21755062','21689817',
                                        '21754831','21689827','21754335','21689860','21689864','21754070','21689868','21754071','21690042','21690092','21754026','21690149','21690238','21754007','21690315','21690320','21753792','21690400','21753469','21690440','21753274','21690491','21690495','21753187','21690575',
                                        '21690615','21753182','21690645','21690701','21690742','21690767','21690837','21753152','21690852','21690967','21753094','21690971','21691112','21691178','21753074','21691227','21753069','21691297','21691656','21752588','21691686','21752441','21692030','21752391','21692540',
                                        '21692549','21692636','21752267','21692665','21752030','21692858','21692968','21693269','21751610','21693290','21751520','21693336','21693530','21751196','21693964','21693974','21694222','21694392','21751077','21694642','21751012','21694816','21750893','21694831','21750697',
                                        '21694970','21750663','21696052','21750564','21696063','21696208','21750441','21696260','21750421','21696333','21696376','21696425','21750189','21696452','21750086','21696655','21696765','21749687','21696794','21749533','21696802','21696851','21696940','21749354','21697075',
                                        '21748973','21697176','21697295','21748902','21697544','21748657','21697581','21748366','21697717','21748327','21697878','21697943','21748259','21697965','21748179','21698163','21698156','21698180','21747931','21698203','21747887','21698257','21747562','21698393','21698400',
                                        '21698459','21747407','21698602','21746959','21698931','21745701','21698952','21698998','21744201','21699434','21699444','21699595','21744002','21699863','21743943','21699907','21699962','21700142','21743871','21700335','21743535','21700562','21743439','21700487','21743279',
                                        '21700622','21700621','21742835','21700917','21742763','21700957','21701173','21701216','21742442','21701349','21742393','21701366','21701507','21741860','21701515','21701526','21741211','21701646','21741166','21701959','21740924','21702094','21740796','21702209','21740707',
                                        '21702326','21740343','21702346','21740210','21702593','21702623','21740129','21702656','21740015','21702901','21739913','21703068','21739754','21703278','21703328','21739501','21703604','21738179','21703639','21738157','21703715','21703761','21703925','21704197','21704860',
                                        '21738142','21704989','21738075','21705243','21737817','21705393','21705723','21737754','21705870','21737670','21705896','21706004','21737380','21706152','21706185','21736761','21706379','21736265','21706424','21736201','21706655','21706828','21735944','21706852','21707537',
                                        '21735677','21707616','21735510','21707646','21735251','21707686','21735177','21707798','21734625','21707891','21734338','21708010','21734250','21708082','21734237','21708278','21734174','21708331','21734120','21708368','21734059','21708415','21708510','21708535','21733898',
                                        '21708762','21708809','21733884','21708965','21709079','21709237','21733834','21709256','21709463','21733731','21709543','21709538','21709678','21709708','21709793','21709800','21709817','21709824','21733118','21709989','21732974','21710019','21710133','21732962','21710201',
                                        '21732728','21710211','21710384','21710421','21710665','21732532','21710681','21710746','21710810','21710891','21710926','21732450','21710949','21710983','21732351','21711037','21732321','21711217','21732112','21711380','21711622','21731906','21711659','21731664','21711714',
                                        '21731534','21711832','21731014','21712179','21712181','21712346','21730933','21712459','21712655','21712687','21712798','21730671','21712812','21730592','21712822','21730286','21712877','21729968','21712886','21712907','21712944','21729585','21713005','21729137','21713042',
                                        '21713130','21728963','21713160','21728828','21713216','21728378','21713228','21713330','21727093','21713351','21726989','21713545','21726742','21713550','21713561','21713709','21724607','21713758','21713805','21721943','21713817','21713875','21720542','21713884','21720167',
                                        '21713909','21713945','21720145','21714021','21714055','21719127','21714262','21718648','21714431','21714463','21718119','21714575','21718056','21715114','21715150','21717744','21715214','21717721','21715225','21717420','21715409','21717262','21715558','21715592','21715603',
                                        '21715647','21715700','21716362','21715797','21715872','21715871','21715892','21715989','21712825','21808406','21716060','21807929','21716255','21807252','21805478','21716704','21805311','21716865','21805019','21717098','21803648','21717167','21803252','21800942','21717273',
                                        '21800698','21717291','21800635','21800268','21717574','21799680','21717650','21799358','21717687','21799283','21799133','21798822','21717940','21798009','21797051','21796974','21718172','21796927','21796813','21796682','21719446','21795723','21793014','21791686','21720482',
                                        '21790380','21790330','21721137','21789864','21721266','21789610','21721871','21789583','21721894','21788912','21787800','21722058','21787572','21723037','21787113','21786679','21724959','21785939','21725434','21785792','21726704','21785594','21785097','21726914','21784910',
                                        '21783150','21727005','21779619','21779283','21727091','21727187','21778942','21727703','21778581','21727820','21778107','21727858','21777885','21728203','21777732','21728310','21777116','21777075','21728416','21776769','21728555','21776711','21776702','21728955','21776565',
                                        '21776544','21729029','21776433','21729103','21776164','21775803','21729136','21775090','21729237','21774444','21729251','21774042','21729292','21773033','21729399','21773021','21771097','21729674','21771049','21729835','21770863','21770755','21730054','21767542','21730110',
                                        '21767161','21766699','21730344','21766253','21730445','21766087','21730464','21765934','21765824','21765652','21764695','21730724','21764488','21730855','21764195','21764057','21764034','21731069','21763626','21731083','21763432','21731130','21763417','21731160','21763388',
                                        '21731191','21762705','21731315','21761993','21731335','21759242','21731388','21758751','21731435','21758428','21731459','21757528','21757416','21731546','21755844','21731655','21755336','21754800','21731753','21752191','21731801','21750863','21750810','21731939','21750757',
                                        '21731995','21750359','21732020','21749312','21732025','21749039','21749026','21732255','21748282','21732265','21747624','21745539','21743342','21732423','21743205','21743027','21732491','21742640','21742202','21732606','21741800','21732696','21741113','21740841','21732735',
                                        '21737792','21732777','21737550','21732824','21732889','21733005','21733064','21733322','21733339','21733432','21733438','21733563','21733751','21733813','21935937','21935651','21935350','21928925','21733944','21927881','21733981','21927405','21734029','21927400','21734046',
                                        '21927186','21927009','21734101','21926449','21926327','21926257','21734177','21925893','21734188','21925887','21925545','21924909','21734251','21924445','21924022','21734350','21923813','21734466','21923806','21734483','21923381','21734488','21923260','21923131','21734839',
                                        '21735074','21922984','21919061','21918790','21735401','21918632','21918375','21735670','21918162','21917999','21735962','21917964','21735998','21917717','21736060','21917626','21736181','21917607','21917331','21736239','21917267','21916947','21736470','21916301','21736600',
                                        '21915831','21736698','21915685','21915669','21736770','21915598','21736771','21915243','21736813','21913930','21736896','21913202','21736958','21912942','21737177','21912723','21737204','21912527','21910609','21737429','21909758','21737486','21909742','21908666','21737607',
                                        '21907850','21907597','21737668','21905217','21905197','21905073','21737802','21905021','21904981','21737896','21904659','21737984','21904600','21737988','21904509','21904378','21738114','21904355','21904221','21903843','21738158','21903831','21903818','21738312','21903798',
                                        '21738456','21903730','21738506','21903584','21738597','21903568','21738620','21903513','21738776','21903187','21738997','21902838','21739149','21902805','21739220','21902639','21739233','21901461','21901287','21739735','21901196','21901188','21901128','21901075','21740020',
                                        '21901056','21740081','21900760','21900699','21900631','21740227','21900584','21740249','21900332','21900047','21740478','21900000','21740615','21899980','21899752','21740726','21899632','21740808','21899360','21740847','21899235','21899118','21899006','21741104','21898403',
                                        '21898363','21741184','21898265','21741291','21898077','21741319','21897652','21741443','21897254','21896708','21741833','21896278','21741817','21895319','21895132','21741926','21893971','21741981','21892243','21742020','21889390','21742032','21889385','21889373','21889362',
                                        '21742421','21889157','21742430','21888945','21888823','21742605','21888484','21888466','21742758','21888309','21888075','21742806','21887941','21887926','21742850','21887858','21742918','21887711','21887665','21743052','21887228','21743103','21886966','21743191','21886854',
                                        '21886841','21886370','21743283','21885572','21743311','21881770','21877678','21743363','21877617','21743389','21877540','21877479','21743444','21877478','21743570','21877422','21743638','21877270','21743693','21877265','21743653','21877187','21877042','21743906','21877009',
                                        '21876986','21743990','21876611','21743999','21876491','21876247','21744032','21876223','21876221','21745182','21876191','21745282','21876061','21745448','21875914','21745466','21875910','21875147','21745551','21875025','21874781','21745763','21874816','21745816','21874625',
                                        '21745937','21874441','21745997','21874344','21746551','21873997','21746704','21873747','21746728','21873532','21746781','21873337','21746906','21873146','21872963','21747236','21872780','21872690','21747535','21872676','21872179','21747580','21872158','21871934','21747755',
                                        '21871697','21747797','21871055','21870346','21870105','21747941','21870103','21868775','21868355','21868108','21866142','21866085','21748507','21866018','21865738','21748699','21865581','21748893','21865239','21864835','21748970','21864882','21864757','21839563','21814018',
                                        '21749226','21814218','21813900','21813881','21813489','21749632','21813537','21813518','21749704','21813142','21749650','21812795','21749995','21812761','21812609','21811921','21750285','21811000','21750290','21810676','21750338','21810638','21750348','21810230','21809898',
                                        '21809842','21809603','21808998','21750659','21808811','21808748','21807243','21750736','21806917','21806794','21805561','21805238','21804715','21750982','21804654','21751000','21804430','21804308','21804191','21751169','21804050','21803999','21751321','21803906','21751339',
                                        '21803742','21751366','21803654','21751422','21803635','21751372','21803487','21751486','21803290','21803196','21751523','21803187','21803163','21751634','21803100','21751674','21803009','21751768','21802724','21751928','21802478','21751959','21802473','21751976','21802399',
                                        '21751988','21802323','21802100','21752065','21801980','21752083','21801895','21801848','21752195','21801808','21752235','21801786','21801541','21752296','21801031','21752306','21800623','21752349','21800191','21799936','21752444','21797834','21797790','21752459','21797118',
                                        '21795949','21752847','21792939','21752860','21792689','21752955','21792607','21792303','21792251','21791706','21791370','21753180','21791271','21790904','21790454','21753262','21790447','21790321','21753281','21790270','21753335','21790247','21753419','21790011','21789430',
                                        '21753548','21789253','21753621','21789089','21788036','21753840','21787825','21753901','21785536','21783522','21778081','21777892','21777301','21754191','21777290','21754143','21776360','21754223','21776160','21754292','21775708','21773961','21754384','21772768','21754415',
                                        '21772760','21754438','21770010','21754510','21764681','21754563','21763811','21754661','21761995','21754678','21761103','21754675','21754683','21734705','21754962','21755076','21755262','21755279','21755476','21755508','21755512','21755609','21755658','21755874','21757031',
                                        '21757257','21960996','21757435','21960996','21757575','21757647','21932484','21757727','21757753','21757883','21930176','21929468','21758075','21758158','21929034','21758241','21758385','21928157','21926709','21758581','21926212','21758806','21925340','21758909','21925223',
                                        '21758921','21758949','21759085','21924507','21759179','21759366','21759511','21759677','21922765','21922554','21760154','21760317','21921428','21920219','21760570','21760599','21919909','21760642','21760721','21760733','21919744','21760811','21760872','21761021','21761111',
                                        '21761195','21919498','21761204','21919192','21761361','21919091','21918806','21761907','21918699','21761923','21918682','21762029','21762132','21918291','21762276','21917979','21762323','21917934','21762344','21917874','21762335','21917720','21762389','21917659','21762450',
                                        '21762554','21762640','21917275','21762659','21762670','21762774','21762816','21917133','21762880','21762993','21762998','21763048','21763073','21763155','21917088','21763236','21763267','21763292','21916880','21763290','21916735','21763307','21763243','21916650','21763421',
                                        '21916544','21763458','21916319','21916284','21763540','21915933','21763574','21763595','21763698','21873410','21763778','21763851','21914851','21764029','21914690','21914623','21764076','21914586','21914077','21764334','21764367','21764410','21764490','21764587','21764625',
                                        '21912428','21764781','21764844','21764931','21764929','21911175','21765002','21911130','21764999','21910622','21765035','21910574','21765110','21909413','21765264','21765321','21908773','21765388','21765429','21908470','21765573','21908024','21765641','21907971','21765738',
                                        '21765776','21765813','21905712','21765842','21765871','21905586','21724902','21905045','21765974','21904727','21766005','21766027','21904763','21904693','21766098','21766159','21766164','21766217','21904477','21766214','21766289','21904188','21766374','21904141','21904120',
                                        '21766560','21903954','21766595','21766660','21903667','21766747','21766809','21766842','21766935','21903421','21766998','21903334','21767054','21767060','21767070','21767228','21767242','21902637','21767311','21767314','21902651','21767414','21902563','21767405','21902472',
                                        '21902215','21767448','21767487','21767549','21767569','21901789','21767636','21901676','21767799','21767866','21767878','21901421','21767916','21769201','21769437','21769550','21901062','21769662','21769666','21769709','21899882','21899837','21899634','21769913','21899624',
                                        '21899600','21770305','21899149','21770683','21662039','21770747','21770801','21898929','21898743','21898304','21771133','21898026','21897828','21897701','21771535','21771778','21897312','21771934','21771966','21897202','21772027','21772044','21772149','21896747','21772208',
                                        '21896520','21772312','21896327','21772389','21896202','21772414','21772481','21895800','21772701','21772708','21895796','21772728','21895779','21772916','21895673','21773028','21895067','21773124','21773216','21894231','21773604','21893806','21773607','21893776','21773693',
                                        '21893478','21773795','21893135','21773910','21892992','21892566','21892397','21774176','21891268','21774219','21890297','21774491','21889348','21774585','21889154','21774627','21774738','21774784','21888951','21774792','21888932','21774809','21774819','21774844','21888843',
                                        '21888779','21775006','21775100','21775126','21888452','21775153','21775196','21887670','21775219','21887400','21775324','21887244','21775375','21775413','21886866','21886801','21775497','21886769','21886560','21775774','21886288','21886120','21886068','21775928','21885624',
                                        '21775931','21885566','21775922','21776028','21776083','21776211','21885542','21776213','21776293','21776315','21776331','21776398','21885416','21885345','21776460','21885191','21776503','21884466','21776546','21884372','21776610','21884272','21884075','21776651','21883942',
                                        '21776713','21883845','21883433','21776773','21776788','21883184','21776804','21882806','21776812','21776912','21882601','21776920','21777108','21881846','21777172','21881755','21881388','21881153','21777384','21881025','21777405','21777428','21777456','21880981','21777452',
                                        '21880970','21777473','21880696','21777483','21880667','21880410','21777766','21880335','21777820','21777836','21777888','21879979','21879947','21879492','21777946','21879419','21778013','21778020','21877682','21877606','21877272','21778122','21877025','21778189','21778232',
                                        '21778275','21876994','21778278','21778316','21876853','21778434','21876872','21778445','21778483','21876819','21778510','21876792','21778532','21876674','21778545','21876702','21876688','21778568','21876588','21778577','21778606','21778635','21876562','21876414','21778695',
                                        '21876348','21778719','21876303','21778726','21876299','21778739','21778832','21876280','21778855','21876213','21876087','21875994','21779003','21875890','21875827','21779145','21875774','21779151','21779183','21875694','21779279','21875583','21779363','21779368','21875462',
                                        '21779433','21875332','21779532','21779547','21779563','21875244','21779555','21875201','21779587','21875122','21779612','21875118','21779655','21779672','21875014','21874985','21779711','21779726','21779733','21779798','21874936','21779800','21779824','21779854','21874476',
                                        '21779862','21779916','21874336','21780041','21874168','21779953','21780080','21780088','21874063','21780138','21873873','21780157','21780241','21780283','21780327','21780441','21873485','21780486','21780914','21781040','21781299','21781500','21872983','21872839','21781830',
                                        '21782136','21872628','21782242','21872595','21782280','21782424','21872314','21782573','21872238','21782695','21872070','21782720','21782855','21872062','21782970','21783166','21783177','21871859','21783304','21783430','21783460','21871604','21871163','21783771','21871088',
                                        '21783811','21871060','21783838','21783894','21870992','21870830','21784275','21869504','21784317','21784412','21784458','21784470','21868172','21784503','21868102','21784573','21784638','21867853','21784761','21867112','21785026','21866147','21785052','21785056','21866030',
                                        '21865960','21785200','21785477','21785494','21785527','21865789','21865666','21865623','21785621','21865561','21785600','21785735','21865431','21785938','21865351','21785968','21865299','21786024','21786045','21865138','21786250','21786330','21786366','21865064','21786382',
                                        '21865036','21786617','21786625','21864964','21864822','21786686','21864802','21786920','21864753','21864728','21848164','21787129','21847133','21813976','21787235','21787267','21787387','21813731','21787478','21787621','21787629','21787697','21813173','21787903','21813151',
                                        '21813113','21813091','21813036','21787985','21812978','21788000','21813013','21788031','21812934','21812852','21788086','21812808','21788127','21812777','21788204','21812683','21812679','21788216','21812657','21788224','21812638','21788335','21812556','21788382','21788444',
                                        '21788462','21788544','21788619','21788672','21812387','21788749','21812383','21788756','21812374','21788786','21812236','21788837','21812112','21788851','21812178','21788907','21812082','21788920','21788930','21812048','21788996','21811971','21811926','21789207','21811833',
                                        '21789230','21789244','21789235','21789255','21811721','21789288','21811616','21789294','21789360','21789379','21789208','21811559','21789448','21811421','21789502','21811263','21789510','21811199','21789605','21811160','21789703','21789711','21810932','21789770','21810911',
                                        '21789818','21810815','21789881','21810810','21789968','21810760','21789987','21810544','21810495','21790035','21810440','21790040','21810412','21790069','21790205','21810395','21790212','21790219','21790218','21810255','21790243','21810226','21810199','21790370','21810000',
                                        '21790377','21790424','21790494','21790516','21809847','21790534','21809792','21790590','21809662','21790644','21790678','21790690','21790775','21809518','21790785','21790793','21790811','21790845','21809498','21809468','21790913','21809453','21790961','21809435','21790979',
                                        '21791046','21791067','21809388','21791077','21791155','21809366','21791182','21791434','21809275','21791455','21791467','21809046','21791537','21791604','21808886','21808872','21791671','21808814','21808680','21791775','21808642','21791787','21791806','21791822','21808576',
                                        '21791851','21808316','21791860','21807999','21791898','21807928','21791904','21807783','21807508','21791959','21791950','21791994','21792047','21792154','21807417','21792172','21807403','21792241','21792277','21807163','21807051','21807014','21792324','21806657','21806495',
                                        '21792380','21806346','21792383','21805908','21792406','21792449','21805841','21792453','21805721','21792496','21792512','21805547','21792514','21805530','21792591','21805413','21792666','21792681','21805310','21792701','21805275','21792704','21805059','21792755','21805058',
                                        '21792768','21804910','21792779','21804883','21792808','21792922','21792943','21792951','21792957','21793011','21792998','21804688','21804681','21793044','21793046','21804653','21793116','21804650','21793164','21804613','21793182','21804603','21793322','21804601','21794146',
                                        '21794390','21804587','21794555','21804563','21794864','21804540','21794969','21794971','21794982','21804536','21794995','21795040','21804478','21795162','21804363','21795197','21795235','21795268','21804294','21795324','21795322','21804283','21795896','21804228','21796045',
                                        '21804165','21796067','21804147','21796133','21796218','21796264','21796275','21804146','21796310','21796388','21804091','21796394','21796382','21804017','21796507','21796527','21796560','21796569','21796594','21804013','21796608','21803982','21796672','21796745','21803930',
                                        '21796779','21803918','21796789','21803873','21796817','21796833','21803844','21803845','21796933','21796978','21796965','21803795','21803766','21797231','21797246','21797256','21803669','21797272','21803643','21797292','21803595','21797402','21797408','21797479','21803525',
                                        '21797486','21797498','21797601','21797663','21803516','21797635','21803504','21797681','21803484','21797723','21803466','21797770','21803422','21803393','21797811','21803381','21797827','21803344','21797930','21803278','21797959','21797932','21797972','21798036','21798114',
                                        '21798141','21798140','21798256','21803221','21798276','21798355','21798405','21798417','21803216','21798444','21803125','21798473','21802790','21798518','21802785','21798645','21802733','21798647','21802629','21798714','21802588','21798723','21802505','21798743','21798893',
                                        '21802491','21798907','21802440','21798975','21802368','21799095','21802367','21799250','21802277','21799255','21802195','21799265','21802158','21802134','21802132','21802088','21799435','21799488','21802041','21799498','21799493','21799542','21799645','21801901','21801898',
                                        '21799717','21799694','21801819','21799763','21801714','21799833','21801734','21799868','21801694','21800006','21800034','21801505','21800019','21800211','21800221','21800224','21801473','21801313','21800325','21801176','21800456','21800490','21801128','21800572','21801095',
                                        '21800625','21800969','21800961','21800657','21800732','21801027','21801046','21801201','21801339','21801341','21801387','21801441','21801595','21801654','21801719','21801973','21801981','21802016','21802045','21802102','21802274','21802308','21802297','21802340','21802647',
                                        '21802646','21802771','21802805','21802897','21802934','21803008','21803051','21803173','21803231','21803222','21803311','21803405','21803501','21803495','21803567','21803618','21803626','21803684','21803745','21803759','21803784','21803841','21803909','21803939','21803995',
                                        '21804014','21803972','21804034','21804043','21804096','21804139','21804179','21804212','21804290','21804378','21804508','21804584','21804607','21804658','21804712','21804714','21804755','21804772','21804850','21805309','21805404','21805773','21805951','21806250','21806292',
                                        '21806500','21806583','21806597','21806640','21806783','21806900','21806912','21806920','21938130','21807035','21932439','21932373','21932198','21807266','21932017','21807267','21931907','21807289','21931175','21807325','21931086','21807381','21930261','21929966','21928096',
                                        '21807543','21927948','21807598','21925077','21807658','21924000','21924080','21918901','21807978','21922232','21807989','21921226','21920229','21808016','21919716','21807991','21808045','21919540','21808188','21919119','21808386','21918766','21808584','21918678','21808632',
                                        '21917295','21917219','21917182','21917113','21917048','21916718','21809167','21916647','21809340','21916579','21916338','21915436','21915218','21914728','21914372','21913685','21809639','21913651','21913636','21913545','21913293','21913236','21810007','21913134','21810081',
                                        '21913131','21810110','21912450','21912098','21810292','21910129','21900645','21909577','21810504','21908915','21908843','21810597','21907980','21906265','21810651','21905776','21810735','21905039','21904605','21904303','21811119','21904052','21811174','21904022','21903592',
                                        '21903141','21811459','21903053','21902949','21811613','21902734','21811627','21811741','21811805','21901813','21901093','21901032','21900779','21811943','21900645','21900238','21811972','21900106','21899442','21898569','21895809','21895162','21894945','21894915','21894195',
                                        '21812405','21893501','21812461','21893151','21812491','21892766','21891593','21890268','21890202','21889970','21889968','21889867','21889299','21812810','21889293','21889184','21812881','21889151','21888758','21888588','21813067','21888520','21888365','21888152','21813356',
                                        '21888100','21813466','21813512','21887126','21886937','21813723','21886664','21886613','21813884','21813937','21885873','21884208','21862884','21883786','21883638','21883244','21883032','21864823','21882780','21864958','21882715','21864989','21882426','21881867','21881662',
                                        '21865173','21881385','21865238','21880629','21865421','21880047','21865424','21879570','21878507','21865477','21877797','21865502','21877538','21865650','21876866','21876678','21876641','21876364','21876283','21876180','21875806','21866256','21866721','21875349','21875276',
                                        '21867967','21875073','21868089','21875127','21875063','21874699','21868192','21874661','21868235','21868245','21873999','21868528','21873806','21869773','21873344','21872971','21872419','21870883','21872034','21871001','21871926','21871164','21875734','21877373','21912625',
                                        '21901260','21900995','21800502','21912517','21643810','21865000','21777152','21871086','21767208','21903881','21804619','21912915','21931091','21642188','21779842','21910336','21900543','21736695','21898342','21666762','21875344','21919051','21675200','21903983','21785788',
                                        '21903392','21694233','21798483','21882363','21738853','21897112','21872313','21766274','21674110','21804325','21682463','21936738','21865590','21777678','21777680','21915489','21798294','21721694','21865428','21904207','21871357','21900836','21778258','21739714','21913993',
                                        '21776681','21901391','21898346','21766943','21807816','21813150','21876355','21762128','21908297','21897069','21925044','21777154','21813554','21873777','21917690','21887642','21865332','21702381','21806745','21757699','21737744','21748404','21928135','21938179','21687815',
                                        '21912068','21804330','21791535','21738860','21864892','21889510','21643707','21796197','21767810','21918047','21874102','21692975','21878816','21677092','21804263','21936918','21898733','21797538','21776613','21882044','21899685','21737982','21911062','21750162','21642586',
                                        '21903135','21791754','21811124','21776636','21908856','21753783','21775587','21883073','21904837','21735559','21873845','21923980','21790150','21792079','21768785','21917289','21719058','21794009','21773143','21790044','21928463','21915300','21918155','21911171','21874439',
                                        '21876629','21933354','21793032','21799901','21787853','21873904','21802050','21798280','21813887','21873750','21674371','21777919','21936045','21752484','21807697','21927924','21784668','21659052','21808100','21650254','21913420','21650517','21766227','21779478','21756235',
                                        '21930085','21910697','21677171','21935964','21931813','21875851','21873379','21643955','21884923','21742661','21644163','21647657','21766592','21898108','21753302','21678752','21908715','21758705','21794548','21658964','21733595','21911411','21812343','21902524','21939524',
                                        '21785305','21900959','21804399','21643285','21908798','21809445','21743446','21801671','21764184','21924552','21921212','21919707','21764276','21933025','21667654','21777743','21796149','21900575','21686430','21763903','21716624','21789606','21674892','21865911','21918939',
                                        '21937835','21922824','21659459','21875521','21904446','21751994','21930070','21764299','21898578','21885135','21682933','21647611','21908435','21873969','21782015','21665820','21668851','21874078','21928662','21875932','21778978','21813761','21923746','21750064','21659282',
                                        '21902382','21813568','21767292','21645607','21802236','21803980','21877109','21904681','21898992','21790746','21756124','21677022','21896460','21702566','21932396','21777002','21764053','21797675','21923137','21801256','21897176','21700492','21777335','21902264','21772656',
                                        '21935498','21912253','21990261','21917170','21668141','21774154','21748464','21640073','21932168','21810563','21924951','21778427','21911705','21875480','21793319','21937627','21782902','21797861','21793643','21762022','21900758','21749443','21932742')
		then 'Y' else 'N' end as "Fraud_Attack_Flag"
	
		, sum(case when dlf.next_payment_date >>= dt.month_end_date or dlf.next_payment_date is null then 1 else 0 end) as "cycl_cmplt_unit"
		, sum(case when dlf.next_payment_date >>= dt.month_end_date or dlf.next_payment_date is null then dlf.prin_amount else 0 end) as "cycl_cmplt_dol"
		
		, sum(case when dlf.ach_red_percentage >> 0 then 1 else 0 end) as "ach_enrol_unit"
		, sum(case when dlf.ach_red_percentage >> 0 then dlf.prin_amount else 0 end) as "ach_enrol_dol"
		
		, sum(case when dlf.loan_status in ('IN REPAY') then 1 else 0 end)                          as "bkt0_cnt"
		, sum(case when (dlf.delinquent_days between 5 and 29) then 1 else 0 end)                   as "bkt5_29_cnt"
        , sum(case when dlf.loan_status in ('1-9 DAYS DELNQ','10-29 DAYS DELNQ') then 1 else 0 end) as "bkt1_cnt"
        , sum(case when dlf.loan_status in ('30-59 DAYS DELNQ') then 1 else 0 end)                  as "bkt2_cnt"
        , sum(case when dlf.loan_status in ('60-89 DAYS DELNQ') then 1 else 0 end)                  as "bkt3_cnt"
        , sum(case when dlf.loan_status in ('90-119 DAYS DELNQ') then 1 else 0 end)                 as "bkt4_cnt"
		, sum(case when dlf.loan_status in ('120+ DAYS DELNQ') then 1 else 0 end)                   as "bkt120_cnt"
		, sum(case when dlf.loan_status in ('DEATH VERIFIED') then 1 else 0 end)                    as "death_verif_cnt"
        , sum(case when dlf.loan_status in ('FORBEARANCE') then 1 else 0 end)                       as "forb_cnt"
        , sum(case when dlf.loan_status in ('PENDING FORBEARANCE') then 1 else 0 end)               as "forb_pend_cnt"
        , sum(case when dlf.loan_status in ('BANKRUPTCY') then 1 else 0 end)                        as "bk_co_cnt"
        , sum(case when dlf.loan_status not in ('IN REPAY','1-9 DAYS DELNQ','10-29 DAYS DELNQ','30-59 DAYS DELNQ','60-89 DAYS DELNQ',
              '90-119 DAYS DELNQ','120+ DAYS DELNQ','DEATH VERIFIED','FORBEARANCE','PENDING FORBEARANCE','BANKRUPTCY') then 1 else 0 end)
											                                                        as "other_cnt"

        , sum(case when dlf.loan_status in ('IN REPAY') then dlf.prin_amount else 0 end)                          as "bkt0_amt"
		, sum(case when (dlf.delinquent_days between 5 and 29) then dlf.prin_amount else 0 end)                   as "bkt5_29_amt"
        , sum(case when dlf.loan_status in ('1-9 DAYS DELNQ','10-29 DAYS DELNQ') then dlf.prin_amount else 0 end) as "bkt1_amt"
        , sum(case when dlf.loan_status in ('30-59 DAYS DELNQ') then dlf.prin_amount else 0 end)                  as "bkt2_amt"
        , sum(case when dlf.loan_status in ('60-89 DAYS DELNQ') then dlf.prin_amount else 0 end)                  as "bkt3_amt"
        , sum(case when dlf.loan_status in ('90-119 DAYS DELNQ') then dlf.prin_amount else 0 end)                 as "bkt4_amt"
		, sum(case when dlf.loan_status in ('120+ DAYS DELNQ') then dlf.prin_amount else 0 end)                   as "bkt120_amt"
		, sum(case when dlf.loan_status in ('DEATH VERIFIED') then dlf.prin_amount else 0 end)                    as "death_verif_amt"
        , sum(case when dlf.loan_status in ('FORBEARANCE') then dlf.prin_amount else 0 end)                       as "forb_amt"
        , sum(case when dlf.loan_status in ('PENDING FORBEARANCE') then dlf.prin_amount else 0 end)               as "forb_pend_amt"
        , sum(case when dlf.loan_status in ('BANKRUPTCY') then dlf.prin_amount else 0 end)                        as "bk_amt"
        , sum(case when dlf.loan_status not in ('IN REPAY','1-9 DAYS DELNQ','10-29 DAYS DELNQ','30-59 DAYS DELNQ','60-89 DAYS DELNQ',
                                               '90-119 DAYS DELNQ','120+ DAYS DELNQ','DEATH VERIFIED','FORBEARANCE','PENDING FORBEARANCE','BANKRUPTCY') then dlf.prin_amount
            else 0 end)                                                                                           as "other_amt"

from SOFIDW.DAILY_LOAN_FACTS dlf
         left join DWMART.loans_blended_daily lbd on dlf.loan_id = lbd.loan_id
         left join DWMART.applications_file af on lbd.id=af.id
         left join SOFIDW.BORROWERS bor on dlf.borrower_id = bor.borrower_id
         left join SOFIDW.DATES dt on dt.date_id = dlf.reporting_date_id
         left join SOFIDW.DATES dt2 on dt2.calendar_date = date_trunc('month', dt.calendar_date)::date - 1
         left join (select * from (select *,
                                          row_number() over (partition by borrower_id,reporting_date_id order by trade_date_id desc) as r_num
                                   from SOFIDW.experian_premier_attributes_view_c_fact
                                   where trade_date_id != 0)exp
                    where exp.r_num=1) exp on bor.borrower_id = exp.borrower_id and exp.reporting_date_id = dt2.date_id
where dlf.reporting_date_id >>= '20200101'
  and dlf.loan_type = 'PL'
  and dlf.loan_status not in ('CHARGE OFF','CHARGE OFF COMPLETE','CHARGE OFF PIF','IN GRACE','PAID IN FULL','PAID IN FULL - NEGATIVE BALANCE','UNBOARDED',
                              'UNKNOWN','WRITE OFF')
group by 1,2,3,4,5,6,7,8,9,10,11,12
